<!DOCTYPE html>
<html lang="en" class="no-js demo-1">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
		<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
		<title>BookBlock: A Content Flip Plugin - Demo 1</title>
		<meta name="description" content="Bookblock: A Content Flip Plugin - Demo 1" />
		<meta name="keywords" content="javascript, jquery, plugin, css3, flip, page, 3d, booklet, book, perspective" />
		<meta name="author" content="Codrops" />
		<link rel="shortcut icon" href="../favicon.ico"> 
		<link rel="stylesheet" type="text/css" href="css/default.css" />
		<link rel="stylesheet" type="text/css" href="css/bookblock.css" />
		<!-- custom demo style -->
		<link rel="stylesheet" type="text/css" href="css/demo1.css" />
		<script src="js/modernizr.custom.js"></script>
		<style>

.my_message
{
height:150px
}
</style>
	</head>
	<body>
		<div class="container">		
			
			<div class="main clearfix">
				<div class="bb-custom-wrapper">
					<div id="bb-bookblock" class="bb-bookblock">
						<div class="bb-item">
							<div class="w3-padding-16 " >
								<img Id="myProfileImage1" class="w3-circle" src="" style="width:50px;height:50px;"> 
								<span Id="userName1" class="w3-xxlarge"> </span>
							</div>
							
							<div class="">
								<img Id="myImage1" src="" style="width:500px;height:400px;"> 
							</div>
							
							<div Id="myMessage1" class="w3-padding-16 w3-large  my_message" > </div>
						</div>
						
						<div class="bb-item">
							<div class="w3-padding-16 " >
								<img Id="myProfileImage2" class="w3-circle" src="" style="width:50px;height:50px;"> 
								<span Id="userName2" class="w3-xxlarge"> </span>
							</div>
							
							<div class="">
								<img Id="myImage2" src="" style="width:500px;height:400px;"> 
							</div>
							
							<div Id="myMessage2" class="w3-padding-16 w3-large  my_message"> </div>
						</div>
					</div>					
				</div>
			</div>
		</div><!-- /container -->
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script src="js/jquerypp.custom.js"></script>
		<script src="js/jquery.bookblock.js"></script>
		<script>
			var slideIndex = 0;
			var queryIndex = 10;
			var toggle = 0;
			var messageList = [];
			var imageList = [];
			var userNameList = [];
			var userIdList = [];
			var url = "https://graph.facebook.com/v2.10/1569234599765262/feed?fields=picture,message,from&access_token=466372347083157|BHzmFE0wq1V0l7tkFcJf5hdLMU4";
			var default_pic = "https://scontent.xx.fbcdn.net/v/t1.0-9/21740391_1702534819777619_3051812303718747661_n.jpg?oh=8b88c90321d890bbf9c5dd5ae02c95c3&oe=5A4995C2";

			function FBquery() 
			{	
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.onreadystatechange = function(){
						if(this.readyState == 4 && this.status == 200) {
							var myArr = JSON.parse(this.responseText).data;
							messageList = [];
							imageList = [];
							userNameList = [];
							userIdList = [];
							for (idx = 0; idx < myArr.length; idx++){
								messageList.push(myArr[idx].message);
								if (myArr[idx].picture)	{
									imageList.push(myArr[idx].picture);
								}else {
									imageList.push(default_pic);
								}
								userNameList.push(myArr[idx].from.name);
								var tmpId = myArr[idx].from.id;
								userIdList.push("http://graph.facebook.com/" + tmpId + "/picture?type=square");
							}
							if(imageList.length < 60){
								queryIndex = 1;
							}else{
								queryIndex = imageList.length - 1;
							}
							window.console.log('query done');
						}
					};
				xmlhttp.open("GET", url, true);
				xmlhttp.send();				
			};

			function showSlides() 
			{
				if(imageList.length != 0){
					if(toggle == 1){
						$( '#bb-bookblock' ).bookblock( 'updatePage' );
						document.getElementById("myImage1").src = imageList[slideIndex];						
						document.getElementById("myProfileImage1").src = userIdList[slideIndex];
						document.getElementById("myMessage1").innerHTML = messageList[slideIndex];
						document.getElementById("userName1").innerHTML = userNameList[slideIndex];
						$( '#bb-bookblock' ).bookblock( 'next' );
						toggle = 0;
					}else{
						$( '#bb-bookblock' ).bookblock( 'updatePage' );
						document.getElementById("myImage2").src = imageList[slideIndex];
						document.getElementById("myProfileImage2").src = userIdList[slideIndex];
						document.getElementById("myMessage2").innerHTML = messageList[slideIndex];
						document.getElementById("userName2").innerHTML = userNameList[slideIndex];
						$( '#bb-bookblock' ).bookblock( 'next' );
						toggle = 1;
					}
					
					slideIndex++;
					if(slideIndex >= imageList.length) { 
						slideIndex = 0; 
					}
					
					queryIndex--;	
					if(queryIndex <= 0) {
						window.console.log("query FB");				
						FBquery(); 
					}
				}
				setTimeout(showSlides, 5000); // Change image every 5 seconds
			}
			var Page = (function() {				
				var config = {
						$bookBlock : $( '#bb-bookblock' )
					},
					init = function() {
						config.$bookBlock.bookblock( {
							speed : 800,
							shadowSides : 0.8,
							shadowFlip : 0.7
						} );
					},
					initEvents = function() {						
						var $slides = config.$bookBlock.children();						
					};
					return { init : init };

			})();
		</script>
		<script>
				Page.init();
				FBquery();
				showSlides();
		</script>
	</body>
</html>